{% extends "base.html" %}
{% block content %}
<div class="page-head">
  <h1 class="h1">Parking spots</h1>
  <div class="sub">Default code = Flat no. Edit a spot to assign to flat, vehicle, driver name.</div>
</div>

<div class="card">
  <div class="toolbar">
    <form method="get" class="filters" style="display:flex; gap:8px; flex-wrap:wrap;">
      <select name="unit" title="Unit (A–H)">
        <option value="">All units</option>
        {% for u in units %}
          <option value="{{ u }}" {% if unit == u %}selected{% endif %}>{{ u }}</option>
        {% endfor %}
      </select>

      <select name="floor" title="Floor (1–14)">
        <option value="">All floors</option>
        {% for f in floors %}
          <option value="{{ f }}" {% if floor == f|stringformat:"s" %}selected{% endif %}>{{ f }}</option>
        {% endfor %}
      </select>

      <select name="reserved" title="Reserved?">
        <option value="">Reserved: Any</option>
        <option value="yes" {% if reserved == "yes" %}selected{% endif %}>Yes</option>
        <option value="no"  {% if reserved == "no"  %}selected{% endif %}>No</option>
      </select>

      <select name="occupied" title="Occupied?">
        <option value="">Occupied: Any</option>
        <option value="yes" {% if occupied == "yes" %}selected{% endif %}>Occupied</option>
        <option value="no"  {% if occupied == "no"  %}selected{% endif %}>Free</option>
      </select>

      <button class="btn" type="submit">Filter</button>
      <a class="btn ghost" href="{% url 'parking:spot_list' %}">Reset</a>
    </form>

    <div class="actions" style="margin-left:auto; display:flex; gap:8px;">
      <form method="post" action="{% url 'parking:spot_seed_all' %}">
        {% csrf_token %}
        <button class="btn" type="submit">Create all (from flats)</button>
      </form>
      <a class="btn ghost" href="{% url 'parking:spot_create' %}">Add spot</a>
      <a class="btn ghost" href="{% url 'parking:vehicle_list' %}">Vehicles</a>
    </div>
  </div>

  <table class="table">
    <thead>
      <tr>
        <th>Code</th>
        <th>Flat</th>
        <th>Level</th>
        <th>Reserved</th>
        <th>Occupied</th>
        <th>Notes</th>
        <th style="width:160px;"></th>
      </tr>
    </thead>
    <tbody>
      {% for s in object_list %}
      <tr>
        <td><strong>{{ s.code }}</strong></td>
        <td>{{ s.flat|default:"—" }}</td>
        <td>{{ s.level }}</td>
        <td>{% if s.is_reserved %}<span class="badge info">Yes</span>{% else %}<span class="badge muted">No</span>{% endif %}</td>
        <td>{% if s.occupied %}<span class="badge ok">Occupied</span>{% else %}<span class="badge muted">Free</span>{% endif %}</td>
        <td>{{ s.notes }}</td>
        <td>
          <a class="btn ghost" href="{% url 'parking:spot_detail' s.pk %}">View</a>
          <a class="btn ghost" href="{% url 'parking:spot_edit' s.pk %}">Edit</a>
        </td>
      </tr>
      {% empty %}
      <tr><td colspan="7" class="muted">No spots found.</td></tr>
      {% endfor %}
    </tbody>
  </table>

  {% include "_includes/pager.html" %}
</div>
{% endblock %}
